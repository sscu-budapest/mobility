schema: '2.0'
stages:
  get_device_counties:
    cmd: python -m src get_device_counties
    deps:
    - path: data/um/ping
      md5: 27dbaced5ca2a34a30074bf11fd52551.dir
      size: 92024227
      nfiles: 3
    - path: src/get_device_counties.py
      md5: 16ce6e50ba22e2c146a9799682be6620
      size: 4046
    params:
      params.yaml:
        min_locale_rate: 0.8
    outs:
    - path: data/get_device_counties/device_county.parquet
      md5: 6fb5cc79cecfc5db71e719b15b4384a0
      size: 2741343
  get_device_days:
    cmd: python -m src get_device_days
    deps:
    - path: data/um/ping
      md5: 27dbaced5ca2a34a30074bf11fd52551.dir
      size: 92024227
      nfiles: 3
    - path: src/get_device_days.py
      md5: 3224c1bf3990ca657b1180551966b756
      size: 1636
    params:
      params.yaml:
        get_device_days.am_end: 10
        get_device_days.am_start: 5
        get_device_days.pm_end: 20
        get_device_days.pm_start: 16
    outs:
    - path: data/get_device_days/device_day
      md5: 7b41d13d2d0f87894b9829a01c149c2d.dir
      size: 2440684
      nfiles: 1
  create_filtered_dataset:
    cmd: python -m src create_filtered_dataset
    deps:
    - path: data/get_device_counties/device_county.parquet
      md5: 6fb5cc79cecfc5db71e719b15b4384a0
      size: 2741343
    - path: data/get_device_days/device_day
      md5: 7b41d13d2d0f87894b9829a01c149c2d.dir
      size: 2440684
      nfiles: 1
    - path: data/um/ping
      md5: 27dbaced5ca2a34a30074bf11fd52551.dir
      size: 92024227
      nfiles: 3
    - path: src/create_filtered_dataset.py
      md5: 22a1bbb01608822543ef36aaa5a8bb1a
      size: 2979
    params:
      params.yaml:
        create_filtered_dataset.min_am: 5
        create_filtered_dataset.min_pm: 5
        create_filtered_dataset.min_reliable_days: 1
        create_filtered_dataset.min_sum: 50
        create_filtered_dataset.specific_to_locale:
        - Budapest
        - Pest
        min_locale_rate: 0.8
    outs:
    - path: data/create_filtered_dataset/filtered_ping
      md5: d0a29b33c88eaaf9956d9a827bdfbf33.dir
      size: 16546150
      nfiles: 1
  stop_detection:
    cmd: python -m src stop_detection
    deps:
    - path: data/create_filtered_dataset/filtered_ping
      md5: d0a29b33c88eaaf9956d9a827bdfbf33.dir
      size: 16546150
      nfiles: 1
    - path: src/stop_detection.py
      md5: 1d3f8ebc0725349d50129ec273a90448
      size: 4738
    params:
      params.yaml:
        stop_detection.distance_metric: haversine
        stop_detection.home_arrive: 20
        stop_detection.home_depart: 8
        stop_detection.max_time_between: 86400
        stop_detection.min_size: 2
        stop_detection.min_staying_time: 300
        stop_detection.min_work_hours: 4
        stop_detection.r1: 20
        stop_detection.r2: 200
        stop_detection.work_end: 17
        stop_detection.work_start: 8
    outs:
    - path: data/stop_detection/stop
      md5: b9052b530b1216894422ce7f5143e3f3.dir
      size: 1949453
      nfiles: 1
