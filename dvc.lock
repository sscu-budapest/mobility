schema: '2.0'
stages:
  small-speed_based_filter:
    cmd: dz run-step small-speed_based_filter
    deps:
    - path: data/gpsping/ubermedia/non_covid_tuesday/extended_ping
      md5: c5f39162b3d0a97cae8fdec5516393cd.dir
      size: 110825870
      nfiles: 256
    - path: src/speed_based_filter.py
      md5: 72887b7c9438f98440c13870ec134270
      size: 3931
    params:
      zimmer.yaml:
        envs.complete.params.speed_based_filter.max_speed: 300
        envs.complete.params.speed_based_filter.min_pings_by_device: 20
    outs:
    - path: data/mobility/speed_based_filter/small/drop_stat.parquet
      md5: 24ae1791772e87f7c146ac261d6e329d
      size: 2961
    - path: data/mobility/speed_based_filter/small/ping_with_arrival
      md5: 6e5394a46f33f676b081392541b1c131.dir
      size: 152030727
      nfiles: 256
  small-initial_stops:
    cmd: dz run-step small-initial_stops
    deps:
    - path: data/mobility/speed_based_filter/small/ping_with_arrival
      md5: 6e5394a46f33f676b081392541b1c131.dir
      size: 152030727
      nfiles: 256
    - path: src/initial_stops.py
      md5: 275b942384e96f0d1b231b69c4fd6f93
      size: 4385
    params:
      zimmer.yaml:
        envs.complete.params.initial_stops.distance_metric: haversine
        envs.complete.params.initial_stops.max_time_between: 7200
        envs.complete.params.initial_stops.min_size: 2
        envs.complete.params.initial_stops.min_staying_time: 270
        envs.complete.params.initial_stops.r1: 370
        envs.complete.params.initial_stops.r2: 140
    outs:
    - path: data/mobility/initial_stops/small/stop
      md5: e36458c1c5acaffe50d48da366adf54a.dir
      size: 12376114
      nfiles: 256
  small-filtered_stops:
    cmd: dz run-step small-filtered_stops
    deps:
    - path: data/mobility/initial_stops/small/stop
      md5: e36458c1c5acaffe50d48da366adf54a.dir
      size: 12376114
      nfiles: 256
    - path: src/filtered_stops.py
      md5: ba3fc10261636a4c432fc542b892656c
      size: 1062
    params:
      zimmer.yaml:
        envs.complete.params.filtered_stops.min_destinations: 2
        envs.complete.params.filtered_stops.min_stops_to_count: 4
    outs:
    - path: data/mobility/filtered_stops/small/stop
      md5: bba09e05eaaea20be5ba2d035b472689.dir
      size: 378417
      nfiles: 30
  small-device_counties:
    cmd: dz run-step small-device_counties
    deps:
    - path: data/mobility/filtered_stops/small/stop
      md5: bba09e05eaaea20be5ba2d035b472689.dir
      size: 378417
      nfiles: 30
    - path: src/device_counties.py
      md5: f0d99a61f58758fbc12a4a1a4179c48f
      size: 3621
    params:
      zimmer.yaml:
        envs.complete.params.device_counties.min_locale_rate: 0.8
    outs:
    - path: data/mobility/device_counties/small/device_county.parquet
      md5: bd9b506026cd07a57764ba2213480f78
      size: 5610
  small-stop_reporting:
    cmd: dz run-step small-stop_reporting
    deps:
    - path: data/gpsping/ubermedia/non_covid_tuesday/extended_ping
      md5: c5f39162b3d0a97cae8fdec5516393cd.dir
      size: 110825870
      nfiles: 256
    - path: data/mobility/filtered_stops/small/stop
      md5: bba09e05eaaea20be5ba2d035b472689.dir
      size: 378417
      nfiles: 30
    - path: data/mobility/initial_stops/small/stop
      md5: e36458c1c5acaffe50d48da366adf54a.dir
      size: 12376114
      nfiles: 256
    - path: src/stop_reporting.py
      md5: be6efcb50ca917f1dd12c32bf8cafad8
      size: 1887
    outs:
    - path: reports/small/stop_look.md
      md5: 395dae535686ad0e1130337ace3d5813
      size: 734
  small-h3_hour_aggregate:
    cmd: dz run-step small-h3_hour_aggregate
    deps:
    - path: data/gpsping/ubermedia/non_covid_tuesday/extended_ping
      md5: c5f39162b3d0a97cae8fdec5516393cd.dir
      size: 110825870
      nfiles: 256
    - path: src/h3_hour_aggregate.py
      md5: 8d319a662b6f4105969247aa74d6a8db
      size: 1862
    params:
      zimmer.yaml:
        envs.complete.params.h3_hour_aggregate.min_count: 3
        envs.complete.params.h3_hour_aggregate.min_duration: 15
    outs:
    - path: data/mobility/h3_hour_aggregate/small/hash_hour
      md5: 8c7d45025a209854810e2fd302f44dde.dir
      size: 517276
      nfiles: 1
  small-semantic_stops:
    cmd: dz run-step small-semantic_stops
    deps:
    - path: data/mobility/filtered_stops/small/stop
      md5: bba09e05eaaea20be5ba2d035b472689.dir
      size: 378417
      nfiles: 30
    - path: src/semantic_stops.py
      md5: 5de9c7f358935a02b9053279f51189a6
      size: 5947
    params:
      zimmer.yaml:
        envs.complete.params.home_arrive: 20
        envs.complete.params.morning_end: 8
        envs.complete.params.semantic_stops.time_unit: W
        envs.complete.params.work_end: 17
    outs:
    - path: data/mobility/semantic_stops/small/semantic_stop
      md5: 3d02a360e6e0d2c6f71afe4d93b9975c.dir
      size: 794853
      nfiles: 30
  complete-speed_based_filter:
    cmd: dz run-step complete-speed_based_filter
    deps:
    - path: data/gpsping/ubermedia/complete/extended_ping
      md5: 64ec416a6f2996899f2220d8481ab83c.dir
      size: 74947155079
      nfiles: 6400
    - path: src/speed_based_filter.py
      md5: 72887b7c9438f98440c13870ec134270
      size: 3931
    params:
      zimmer.yaml:
        envs.complete.params.speed_based_filter.max_speed: 300
        envs.complete.params.speed_based_filter.min_pings_by_device: 20
    outs:
    - path: data/mobility/speed_based_filter/complete/drop_stat.parquet
      md5: c72b88377e29c2018a94cc78e899c040
      size: 17223
    - path: data/mobility/speed_based_filter/complete/ping_with_arrival
      md5: ab2c899daf96e7a9fbe4b99d2a99a5c5.dir
      size: 112002849932
      nfiles: 256
  complete-initial_stops:
    cmd: dz run-step complete-initial_stops
    deps:
    - path: data/mobility/speed_based_filter/complete/ping_with_arrival
      md5: ab2c899daf96e7a9fbe4b99d2a99a5c5.dir
      size: 112002849932
      nfiles: 256
    - path: src/initial_stops.py
      md5: 275b942384e96f0d1b231b69c4fd6f93
      size: 4385
    params:
      zimmer.yaml:
        envs.complete.params.initial_stops.distance_metric: haversine
        envs.complete.params.initial_stops.max_time_between: 7200
        envs.complete.params.initial_stops.min_size: 2
        envs.complete.params.initial_stops.min_staying_time: 270
        envs.complete.params.initial_stops.r1: 370
        envs.complete.params.initial_stops.r2: 140
    outs:
    - path: data/mobility/initial_stops/complete/stop
      md5: 78df028653f512175b90c54fe8aedce7.dir
      size: 7278642899
      nfiles: 256
  complete-filtered_stops:
    cmd: dz run-step complete-filtered_stops
    deps:
    - path: data/mobility/initial_stops/complete/stop
      md5: 78df028653f512175b90c54fe8aedce7.dir
      size: 7278642899
      nfiles: 256
    - path: src/filtered_stops.py
      md5: ba3fc10261636a4c432fc542b892656c
      size: 1062
    params:
      zimmer.yaml:
        envs.complete.params.filtered_stops.min_destinations: 2
        envs.complete.params.filtered_stops.min_stops_to_count: 4
    outs:
    - path: data/mobility/filtered_stops/complete/stop
      md5: f34be16b05e33d15a5d24293820aec2a.dir
      size: 5870983977
      nfiles: 256
  complete-device_counties:
    cmd: dz run-step complete-device_counties
    deps:
    - path: data/mobility/filtered_stops/complete/stop
      md5: f34be16b05e33d15a5d24293820aec2a.dir
      size: 5870983977
      nfiles: 256
    - path: src/device_counties.py
      md5: f0d99a61f58758fbc12a4a1a4179c48f
      size: 3621
    params:
      zimmer.yaml:
        envs.complete.params.device_counties.min_locale_rate: 0.8
    outs:
    - path: data/mobility/device_counties/complete/device_county.parquet
      md5: 339450af56e2ea6662ce0fd4789d1ef6
      size: 28217411
  complete-stop_reporting:
    cmd: dz run-step complete-stop_reporting
    deps:
    - path: data/gpsping/ubermedia/complete/extended_ping
      md5: 64ec416a6f2996899f2220d8481ab83c.dir
      size: 74947155079
      nfiles: 6400
    - path: data/mobility/filtered_stops/complete/stop
      md5: f34be16b05e33d15a5d24293820aec2a.dir
      size: 5870983977
      nfiles: 256
    - path: data/mobility/initial_stops/complete/stop
      md5: 78df028653f512175b90c54fe8aedce7.dir
      size: 7278642899
      nfiles: 256
    - path: src/stop_reporting.py
      md5: be6efcb50ca917f1dd12c32bf8cafad8
      size: 1887
    outs:
    - path: reports/complete/stop_look.md
      md5: 360a979727529cfcd533351a027efc9a
      size: 734
