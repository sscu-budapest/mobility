schema: '2.0'
stages:
  small-get_device_days:
    cmd: datazimmer run-step small-get_device_days
    deps:
    - path: data/gpsping/ubermedia/non_covid_tuesday/ping
      md5: 7157e7a019ec8bc35bfc410fbe9a9a44.dir
      size: 81374809
      nfiles: 3
    - path: src/get_device_days.py
      md5: 328532b8bd8d5fc9edd1c575013e5b2a
      size: 1639
    params:
      zimmer.yaml:
        envs.complete.params.get_device_days.am_end: 10
        envs.complete.params.get_device_days.am_start: 5
        envs.complete.params.get_device_days.pm_end: 20
        envs.complete.params.get_device_days.pm_start: 16
    outs:
    - path: data/mobility/get_device_days/small/device_day
      md5: 42e30a4c505d577ee8bd99db62b75db4.dir
      size: 5171811
      nfiles: 1
  small-get_device_counties:
    cmd: datazimmer run-step small-get_device_counties
    deps:
    - path: data/gpsping/ubermedia/non_covid_tuesday/ping
      md5: 7157e7a019ec8bc35bfc410fbe9a9a44.dir
      size: 81374809
      nfiles: 3
    - path: src/get_device_counties.py
      md5: 7fbae7d164d9f1d05180d1f826845b28
      size: 4143
    params:
      zimmer.yaml:
        envs.complete.params.min_locale_rate: 0.8
    outs:
    - path: data/mobility/get_device_counties/small/device_county.parquet
      md5: ca4967ea6604fd8d2878ac6cc52b0309
      size: 5537140
  small-raster_aggregate:
    cmd: datazimmer run-step small-raster_aggregate
    deps:
    - path: data/gpsping/ubermedia/non_covid_tuesday/ping
      md5: 7157e7a019ec8bc35bfc410fbe9a9a44.dir
      size: 81374809
      nfiles: 3
    - path: src/raster_aggregate.py
      md5: b91a560550053228bfe59da0e8d986be
      size: 2276
    params:
      zimmer.yaml:
        envs.complete.params.raster_aggregate.min_count: 3
        envs.complete.params.raster_aggregate.min_duration: 15
    outs:
    - path: data/mobility/raster_aggregate/small/raster_hour
      md5: 4cb35de75092e01307b3ef4b3f4e6b89.dir
      size: 741164
      nfiles: 1
  small-create_filtered_dataset:
    cmd: datazimmer run-step small-create_filtered_dataset
    deps:
    - path: data/gpsping/ubermedia/non_covid_tuesday/ping
      md5: 7157e7a019ec8bc35bfc410fbe9a9a44.dir
      size: 81374809
      nfiles: 3
    - path: data/mobility/get_device_counties/small/device_county.parquet
      md5: ca4967ea6604fd8d2878ac6cc52b0309
      size: 5537140
    - path: data/mobility/get_device_days/small/device_day
      md5: 42e30a4c505d577ee8bd99db62b75db4.dir
      size: 5171811
      nfiles: 1
    - path: src/create_filtered_dataset.py
      md5: f16ed3af923f1f3b63405fd02e27e5f0
      size: 3320
    params:
      zimmer.yaml:
        envs.complete.params.create_filtered_dataset.min_am: 5
        envs.complete.params.create_filtered_dataset.min_pm: 5
        envs.complete.params.create_filtered_dataset.min_reliable_days: 1
        envs.complete.params.create_filtered_dataset.min_sum: 50
        envs.complete.params.create_filtered_dataset.specific_to_locale:
        - Budapest
        - Pest
        envs.complete.params.min_locale_rate: 0.8
    outs:
    - path: data/mobility/create_filtered_dataset/small/filtered_ping
      md5: 5704521d0f9222cdbefcbef07a046d5a.dir
      size: 7501975
      nfiles: 1
  small-stop_detection:
    cmd: datazimmer run-step small-stop_detection
    deps:
    - path: data/mobility/create_filtered_dataset/small/filtered_ping
      md5: 5704521d0f9222cdbefcbef07a046d5a.dir
      size: 7501975
      nfiles: 1
    - path: src/stop_detection.py
      md5: 8a44be7854e18d06574898e7d5460c62
      size: 7413
    params:
      zimmer.yaml:
        envs.complete.params.stop_detection.distance_metric: haversine
        envs.complete.params.stop_detection.home_arrive: 20
        envs.complete.params.stop_detection.home_depart: 8
        envs.complete.params.stop_detection.max_time_between: 86400
        envs.complete.params.stop_detection.min_size: 2
        envs.complete.params.stop_detection.min_staying_time: 270
        envs.complete.params.stop_detection.min_work_hours: 4
        envs.complete.params.stop_detection.r1: 370
        envs.complete.params.stop_detection.r2: 140
        envs.complete.params.stop_detection.work_end: 17
        envs.complete.params.stop_detection.work_start: 8
    outs:
    - path: data/mobility/stop_detection/small/stop
      md5: d1a9e59a5982cc2838c0373496c01156.dir
      size: 1216889
      nfiles: 1
  complete-get_device_counties:
    cmd: datazimmer run-step complete-get_device_counties
    deps:
    - path: data/gpsping/ubermedia/complete/ping
      md5: e9e14339faf257a9668d92af746ecd97.dir
      size: 62558414306
      nfiles: 1990
    - path: src/get_device_counties.py
      md5: 7fbae7d164d9f1d05180d1f826845b28
      size: 4143
    params:
      zimmer.yaml:
        envs.complete.params.min_locale_rate: 0.8
    outs:
    - path: data/mobility/get_device_counties/complete/device_county.parquet
      md5: 31b081b79eb3723b69d606f7613db420
      size: 370102631
  complete-get_device_days:
    cmd: datazimmer run-step complete-get_device_days
    deps:
    - path: data/gpsping/ubermedia/complete/ping
      md5: e9e14339faf257a9668d92af746ecd97.dir
      size: 62558414306
      nfiles: 1990
    - path: src/get_device_days.py
      md5: 328532b8bd8d5fc9edd1c575013e5b2a
      size: 1639
    params:
      zimmer.yaml:
        envs.complete.params.get_device_days.am_end: 10
        envs.complete.params.get_device_days.am_start: 5
        envs.complete.params.get_device_days.pm_end: 20
        envs.complete.params.get_device_days.pm_start: 16
    outs:
    - path: data/mobility/get_device_days/complete/device_day
      md5: 7217fa16ec20441ff58d4045f63ec358.dir
      size: 2766778386
      nfiles: 25
  complete-create_filtered_dataset:
    cmd: datazimmer run-step complete-create_filtered_dataset
    deps:
    - path: data/gpsping/ubermedia/complete/ping
      md5: e9e14339faf257a9668d92af746ecd97.dir
      size: 62558414306
      nfiles: 1990
    - path: data/mobility/get_device_counties/complete/device_county.parquet
      md5: 31b081b79eb3723b69d606f7613db420
      size: 370102631
    - path: data/mobility/get_device_days/complete/device_day
      md5: 7217fa16ec20441ff58d4045f63ec358.dir
      size: 2766778386
      nfiles: 25
    - path: src/create_filtered_dataset.py
      md5: f16ed3af923f1f3b63405fd02e27e5f0
      size: 3320
    params:
      zimmer.yaml:
        envs.complete.params.create_filtered_dataset.min_am: 5
        envs.complete.params.create_filtered_dataset.min_pm: 5
        envs.complete.params.create_filtered_dataset.min_reliable_days: 1
        envs.complete.params.create_filtered_dataset.min_sum: 50
        envs.complete.params.create_filtered_dataset.specific_to_locale:
        - Budapest
        - Pest
        envs.complete.params.min_locale_rate: 0.8
    outs:
    - path: data/mobility/create_filtered_dataset/complete/filtered_ping
      md5: 37543329f209bfc3a9502daf51467410.dir
      size: 7763293798
      nfiles: 731
  complete-raster_aggregate:
    cmd: datazimmer run-step complete-raster_aggregate
    deps:
    - path: data/gpsping/ubermedia/complete/ping
      md5: e9e14339faf257a9668d92af746ecd97.dir
      size: 62558414306
      nfiles: 1990
    - path: src/raster_aggregate.py
      md5: b91a560550053228bfe59da0e8d986be
      size: 2276
    params:
      zimmer.yaml:
        envs.complete.params.raster_aggregate.min_count: 3
        envs.complete.params.raster_aggregate.min_duration: 15
    outs:
    - path: data/mobility/raster_aggregate/complete/raster_hour
      md5: 29f9f14e8fa40268704f9a0436820884.dir
      size: 885384078
      nfiles: 24
  complete-stop_detection:
    cmd: datazimmer run-step complete-stop_detection
    deps:
    - path: data/mobility/create_filtered_dataset/complete/filtered_ping
      md5: 37543329f209bfc3a9502daf51467410.dir
      size: 7763293798
      nfiles: 731
    - path: src/stop_detection.py
      md5: 8a44be7854e18d06574898e7d5460c62
      size: 7413
    params:
      zimmer.yaml:
        envs.complete.params.stop_detection.distance_metric: haversine
        envs.complete.params.stop_detection.home_arrive: 20
        envs.complete.params.stop_detection.home_depart: 8
        envs.complete.params.stop_detection.max_time_between: 86400
        envs.complete.params.stop_detection.min_size: 2
        envs.complete.params.stop_detection.min_staying_time: 270
        envs.complete.params.stop_detection.min_work_hours: 4
        envs.complete.params.stop_detection.r1: 370
        envs.complete.params.stop_detection.r2: 140
        envs.complete.params.stop_detection.work_end: 17
        envs.complete.params.stop_detection.work_start: 8
    outs:
    - path: data/mobility/stop_detection/complete/stop
      md5: 73a263f8744721ced55b68fd7e697f45.dir
      size: 984287043
      nfiles: 731
