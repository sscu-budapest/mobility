schema: '2.0'
stages:
  small-speed_based_filter:
    cmd: dz run-step speed_based_filter small
    deps:
    - path: data/gpsping/ubermedia/non_covid_tuesday/extended_ping
      md5: 9b14c017f57467aeb5f77eff57858c56.dir
      size: 110562089
      nfiles: 256
    - path: src/speed_based_filter.py
      md5: dd38e2dd073ebad7838800426c2691a0
      size: 3898
    params:
      zimmer.yaml:
        envs.complete.params.speed_based_filter.max_speed: 300
        envs.complete.params.speed_based_filter.min_pings_by_device: 20
    outs:
    - path: data/mobility/speed_based_filter/small/drop_stat.parquet
      md5: 264631a88fb20d2108b01895aa683e49
      size: 2961
    - path: data/mobility/speed_based_filter/small/ping_with_arrival
      md5: 3c62ea914275d8ef54dfb52b5bfec14a.dir
      size: 151867452
      nfiles: 256
  small-initial_stops:
    cmd: dz run-step initial_stops small
    deps:
    - path: data/mobility/speed_based_filter/small/ping_with_arrival
      md5: 3c62ea914275d8ef54dfb52b5bfec14a.dir
      size: 151867452
      nfiles: 256
    - path: src/initial_stops.py
      md5: 72869ba5d996dd7b38bc77a2fb1d91c0
      size: 4426
    params:
      zimmer.yaml:
        envs.complete.params.initial_stops.distance_metric: haversine
        envs.complete.params.initial_stops.max_time_between: 7200
        envs.complete.params.initial_stops.min_size: 2
        envs.complete.params.initial_stops.min_staying_time: 270
        envs.complete.params.initial_stops.r1: 370
        envs.complete.params.initial_stops.r2: 140
    outs:
    - path: data/mobility/initial_stops/small/stop
      md5: 8fe87179c7b1cf30b492dbc1611e41ac.dir
      size: 12260186
      nfiles: 256
  small-filtered_stops:
    cmd: dz run-step filtered_stops small
    deps:
    - path: data/mobility/initial_stops/small/stop
      md5: 8fe87179c7b1cf30b492dbc1611e41ac.dir
      size: 12260186
      nfiles: 256
    - path: src/filtered_stops.py
      md5: 7bab4044010b2bdb1ba0f70c93d0f3c1
      size: 987
    params:
      zimmer.yaml:
        envs.complete.params.filtered_stops.min_destinations: 2
        envs.complete.params.filtered_stops.min_stops_to_count: 4
    outs:
    - path: data/mobility/filtered_stops/small/stop
      md5: 07e6feb086daeb0f14240d205b6054f2.dir
      size: 365127
      nfiles: 30
  small-device_counties:
    cmd: dz run-step device_counties small
    deps:
    - path: data/mobility/filtered_stops/small/stop
      md5: 07e6feb086daeb0f14240d205b6054f2.dir
      size: 365127
      nfiles: 30
    - path: src/device_counties.py
      md5: f5a2002d6a4bbaad8385c927c1396df0
      size: 3324
    params:
      zimmer.yaml:
        envs.complete.params.device_counties.min_locale_rate: 0.8
    outs:
    - path: data/mobility/device_counties/small/device_county.parquet
      md5: 48d244f003a78084f0750a33f0dca4c2
      size: 5617
  small-stop_reporting:
    cmd: dz run-step stop_reporting small
    deps:
    - path: data/gpsping/ubermedia/non_covid_tuesday/extended_ping
      md5: 9b14c017f57467aeb5f77eff57858c56.dir
      size: 110562089
      nfiles: 256
    - path: data/mobility/filtered_stops/small/stop
      md5: 07e6feb086daeb0f14240d205b6054f2.dir
      size: 365127
      nfiles: 30
    - path: data/mobility/initial_stops/small/stop
      md5: 8fe87179c7b1cf30b492dbc1611e41ac.dir
      size: 12260186
      nfiles: 256
    - path: src/stop_reporting.py
      md5: 4257d554dcaec108b0a8f637c7d5c04f
      size: 2025
    outs:
    - path: reports/small/stop_look.md
      md5: edc8b8aadae9654ba346716c1bdbaf6d
      size: 734
  small-semantic_stops:
    cmd: dz run-step semantic_stops small
    deps:
    - path: data/mobility/filtered_stops/small/stop
      md5: 07e6feb086daeb0f14240d205b6054f2.dir
      size: 365127
      nfiles: 30
    - path: src/semantic_stops.py
      md5: ed6116a290e20db6a5c2e87d11ae51c7
      size: 6291
    params:
      zimmer.yaml:
        envs.complete.params.home_arrive: 20
        envs.complete.params.morning_end: 8
        envs.complete.params.semantic_stops.time_unit: W
        envs.complete.params.work_end: 17
        envs.small.params.semantic_stops.min_home_hours: 2
        envs.small.params.semantic_stops.min_work_hours: 0.5
    outs:
    - path: data/mobility/semantic_stops/small/semantic_stop
      md5: 8d74071c027e3df9402483997e86d00c.dir
      size: 758952
      nfiles: 30
  complete-speed_based_filter:
    cmd: dz run-step speed_based_filter complete
    deps:
    - path: data/gpsping/ubermedia/complete/extended_ping
      md5: bf495962a3b6a01a463b7f8ea3f58d7a.dir
      size: 74840147407
      nfiles: 6144
    - path: src/speed_based_filter.py
      md5: dd38e2dd073ebad7838800426c2691a0
      size: 3898
    params:
      zimmer.yaml:
        envs.complete.params.speed_based_filter.max_speed: 300
        envs.complete.params.speed_based_filter.min_pings_by_device: 20
    outs:
    - path: data/mobility/speed_based_filter/complete/drop_stat.parquet
      md5: 4619256b9c70460bdfbaa30fb8b98016
      size: 17219
    - path: data/mobility/speed_based_filter/complete/ping_with_arrival
      md5: 84a86d17b72260f69d2ef9b5fb2c12cd.dir
      size: 112143250277
      nfiles: 256
  complete-initial_stops:
    cmd: dz run-step initial_stops complete
    deps:
    - path: data/mobility/speed_based_filter/complete/ping_with_arrival
      md5: 84a86d17b72260f69d2ef9b5fb2c12cd.dir
      size: 112143250277
      nfiles: 256
    - path: src/initial_stops.py
      md5: 72869ba5d996dd7b38bc77a2fb1d91c0
      size: 4426
    params:
      zimmer.yaml:
        envs.complete.params.initial_stops.distance_metric: haversine
        envs.complete.params.initial_stops.max_time_between: 7200
        envs.complete.params.initial_stops.min_size: 2
        envs.complete.params.initial_stops.min_staying_time: 270
        envs.complete.params.initial_stops.r1: 370
        envs.complete.params.initial_stops.r2: 140
    outs:
    - path: data/mobility/initial_stops/complete/stop
      md5: 212d26f3fea6019b0ece098bbf87689f.dir
      size: 7279970629
      nfiles: 256
  complete-filtered_stops:
    cmd: dz run-step filtered_stops complete
    deps:
    - path: data/mobility/initial_stops/complete/stop
      md5: 212d26f3fea6019b0ece098bbf87689f.dir
      size: 7279970629
      nfiles: 256
    - path: src/filtered_stops.py
      md5: 7bab4044010b2bdb1ba0f70c93d0f3c1
      size: 987
    params:
      zimmer.yaml:
        envs.complete.params.filtered_stops.min_destinations: 2
        envs.complete.params.filtered_stops.min_stops_to_count: 4
    outs:
    - path: data/mobility/filtered_stops/complete/stop
      md5: 21dc077dafa704a6e7d38a721a5ff073.dir
      size: 5871712048
      nfiles: 256
  complete-device_counties:
    cmd: dz run-step device_counties complete
    deps:
    - path: data/mobility/filtered_stops/complete/stop
      md5: 21dc077dafa704a6e7d38a721a5ff073.dir
      size: 5871712048
      nfiles: 256
    - path: src/device_counties.py
      md5: f5a2002d6a4bbaad8385c927c1396df0
      size: 3324
    params:
      zimmer.yaml:
        envs.complete.params.device_counties.min_locale_rate: 0.8
    outs:
    - path: data/mobility/device_counties/complete/device_county.parquet
      md5: 51480a28a4b1ab0efeb8f6608c4826e7
      size: 42927059
  complete-stop_reporting:
    cmd: dz run-step stop_reporting complete
    deps:
    - path: data/gpsping/ubermedia/complete/extended_ping
      md5: bf495962a3b6a01a463b7f8ea3f58d7a.dir
      size: 74840147407
      nfiles: 6144
    - path: data/mobility/filtered_stops/complete/stop
      md5: 21dc077dafa704a6e7d38a721a5ff073.dir
      size: 5871712048
      nfiles: 256
    - path: data/mobility/initial_stops/complete/stop
      md5: 212d26f3fea6019b0ece098bbf87689f.dir
      size: 7279970629
      nfiles: 256
    - path: src/stop_reporting.py
      md5: 4257d554dcaec108b0a8f637c7d5c04f
      size: 2025
    outs:
    - path: reports/complete/stop_look.md
      md5: a578fcd9af7ca4cfeb29449255e97f43
      size: 734
  complete-semantic_stops:
    cmd: dz run-step semantic_stops complete
    deps:
    - path: data/mobility/filtered_stops/complete/stop
      md5: 21dc077dafa704a6e7d38a721a5ff073.dir
      size: 5871712048
      nfiles: 256
    - path: src/semantic_stops.py
      md5: 14a4ba7d700d86b9f61c7239e43624ae
      size: 6492
    params:
      zimmer.yaml:
        envs.complete.params.home_arrive: 20
        envs.complete.params.morning_end: 8
        envs.complete.params.semantic_stops.min_home_hours: 8
        envs.complete.params.semantic_stops.min_work_hours: 3
        envs.complete.params.semantic_stops.time_unit: W
        envs.complete.params.work_end: 17
    outs:
    - path: data/mobility/semantic_stops/complete/semantic_stop
      md5: 03a6b4afe5065d814a3fae746cba2407.dir
      size: 10989794207
      nfiles: 256
  small-semantic_info:
    cmd: dz run-step semantic_info small
    deps:
    - path: data/mobility/semantic_stops/small/semantic_stop
      md5: 8d74071c027e3df9402483997e86d00c.dir
      size: 758952
      nfiles: 30
    - path: src/semantic_info.py
      md5: 4f20d57a892cd967e140734e7143ec8a
      size: 1118
    outs:
    - path: data/mobility/semantic_info/small/semantic_temporal_info.parquet
      md5: 66eb77b8b06ae64819154d4c8e6484c7
      size: 6426
